AWSTemplateFormatVersion: "2010-09-09"
Description: CAPITA MI Common Bucket Policy Update

Parameters:
  pEnvironment:
    Type: String
    Default: DEV
    Description: Environment label to apply to resources naming
  pEnvironmentLowerCase:
    Type: String
    Default: dev
    Description: Environment label to apply to resources naming, lower case
  pDepartment:
    Type: String
    Default: ccm
    Description: Department identifier for unique bucket naming, lowercase
  pCommonReportingBucket:
    Type: String
    Description: Name of common reporting Bucket

Resources:

  CommonConnectS3BucketPolicy:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket: !Ref pCommonReportingBucket
      PolicyDocument:
        Statement:
        -
          Sid: StmtID
          Effect: Allow
          Principal:
            AWS: !Sub "arn:aws:iam::907290942892:role/rl_mi_ctr_${pEnvironmentLowerCase}"
          Action:
          - s3:AbortMultipartUpload
          - s3:GetBucketLocation
          - s3:GetObject
          - s3:ListBucket
          - s3:ListBucketMultipartUploads
          - s3:PutObject
          - s3:PutObjectAcl
          Resource:
          - !Sub "arn:aws:s3:::${pCommonReportingBucket}"
          - !Sub "arn:aws:s3:::${pCommonReportingBucket}/*"
